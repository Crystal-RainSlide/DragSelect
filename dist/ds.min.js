"use strict";var DragSelect=function(){function DragSelect(_a){var _b=_a.selectedClass,selectedClass=_b===void 0?"ds-selected":_b,_c=_a.hoverClass,hoverClass=_c===void 0?"ds-hover":_c,_d=_a.selectorClass,selectorClass=_d===void 0?"ds-selector":_d,_e=_a.selectableClass,selectableClass=_e===void 0?"ds-selectable":_e,_f=_a.selectables,selectables=_f===void 0?[]:_f,_g=_a.multiSelectKeys,multiSelectKeys=_g===void 0?["ctrlKey","shiftKey","metaKey"]:_g,_h=_a.multiSelectMode,multiSelectMode=_h===void 0?false:_h,_j=_a.autoScrollSpeed,autoScrollSpeed=_j===void 0?1:_j,_k=_a.onElementSelect,onElementSelect=_k===void 0?function(){}:_k,_l=_a.onElementUnselect,onElementUnselect=_l===void 0?function(){}:_l,_m=_a.onDragStartBegin,onDragStartBegin=_m===void 0?function(){}:_m,_o=_a.onDragStart,onDragStart=_o===void 0?function(){}:_o,_p=_a.onDragMove,onDragMove=_p===void 0?function(){}:_p,_q=_a.callback,callback=_q===void 0?function(){}:_q,_r=_a.area,area=_r===void 0?document:_r,_s=_a.customStyles,customStyles=_s===void 0?false:_s,_t=_a.selector,selector=_t===void 0?undefined:_t;this.selectables=[];this._prevSelected=[];this._breaked=false;this.multiSelectKeyPressed=false;this.initialScroll={x:0,y:0};this.initialCursorPos={x:0,y:0};this.newCursorPos={x:0,y:0};this.previousCursorPos={x:0,y:0};this.selected=[];this.mouseInteraction=false;this.isElementTouching=function(element,selectionRect,scroll){var rect=element.getBoundingClientRect();var elementRect={y:rect.top+scroll.y,x:rect.left+scroll.x,h:rect.height,w:rect.width};if(selectionRect.x<elementRect.x+elementRect.w&&selectionRect.x+selectionRect.w>elementRect.x&&selectionRect.y<elementRect.y+elementRect.h&&selectionRect.h+selectionRect.y>elementRect.y){return true}else{return false}};this.selectedClass=selectedClass;this.hoverClass=hoverClass;this.selectorClass=selectorClass;this.selectableClass=selectableClass;this.multiSelectKeys=multiSelectKeys;this.multiSelectMode=multiSelectMode;this.autoScrollSpeed=autoScrollSpeed===0?0:autoScrollSpeed;this.onElementSelect=onElementSelect;this.onElementUnselect=onElementUnselect;this.onDragStartBegin=onDragStartBegin;this.onDragStart=onDragStart;this.onDragMove=onDragMove;this.callback=callback;this.area=area;this.customStyles=customStyles;this.selector=selector||this._createSelector();this.selector.classList.add(this.selectorClass);this._handleSelectables(this.toArray(selectables));if(this.area!==document){var computedArea=getComputedStyle(this.area);var isPositioned=computedArea.position==="absolute"||computedArea.position==="relative"||computedArea.position==="fixed";if(!isPositioned){this.area.style.position="relative"}}this._createBindings();this.start()}DragSelect.prototype._createBindings=function(){this._startUp=this._startUp.bind(this);this._handleMove=this._handleMove.bind(this);this.reset=this.reset.bind(this);this._onClick=this._onClick.bind(this)};DragSelect.prototype._handleSelectables=function(selectables,remove,toSelection){for(var index=0,il=selectables.length;index<il;index++){var selectable=selectables[index];var indexOf=this.selectables.indexOf(selectable);if(indexOf<0&&!remove){this._addSelectable(selectable,toSelection)}else if(indexOf>-1&&remove){this._removeSelectable(selectable,indexOf,toSelection)}}};DragSelect.prototype._addSelectable=function(selectable,toSelection){selectable.classList.add(this.selectableClass);selectable.addEventListener("click",this._onClick);this.selectables.push(selectable);if(toSelection&&this.selected.indexOf(selectable)<0){selectable.classList.add(this.selectedClass);this.selected.push(selectable)}};DragSelect.prototype._removeSelectable=function(selectable,indexOf,toSelection){selectable.classList.remove(this.hoverClass);selectable.classList.remove(this.selectableClass);selectable.removeEventListener("click",this._onClick);this.selectables.splice(indexOf,1);if(toSelection&&this.selected.indexOf(selectable)>-1){selectable.classList.remove(this.selectedClass);this.selected.splice(this.selected.indexOf(selectable),1)}};DragSelect.prototype._createSelector=function(){var selector=document.createElement("div");selector.style.position="absolute";if(!this.customStyles){selector.style.background="rgba(0, 0, 255, 0.1)";selector.style.border="1px solid rgba(0, 0, 255, 0.45)";selector.style.display="none";selector.style.pointerEvents="none"}var _area=this.area===document?document.body:this.area;_area.appendChild(selector);return selector};DragSelect.prototype._onClick=function(event){if(this.mouseInteraction)return;if(this.isRightClick(event))return;var node=event.target;if(this.isMultiSelectKeyPressed(event)){this._prevSelected=this.selected.slice()}else{this._prevSelected=[]}this.checkIfInsideSelection(true);if(this.selectables.indexOf(node)>-1)this.toggle(node);this.reset()};DragSelect.prototype.isMultiSelectKeyPressed=function(event){var _this=this;this.multiSelectKeyPressed=false;if(this.multiSelectMode)this.multiSelectKeyPressed=true;else this.multiSelectKeys.forEach(function(mKey){if(event[mKey])_this.multiSelectKeyPressed=true});return this.multiSelectKeyPressed};DragSelect.prototype.start=function(){this.area.addEventListener("mousedown",this._startUp);this.area.addEventListener("touchstart",this._startUp,{passive:false})};DragSelect.prototype._startUp=function(event){if(event.type==="touchstart")event.preventDefault();this.onDragStartBegin(event);if(this._breaked)return false;if(this.isRightClick(event)){return}this.mouseInteraction=true;this.selector.style.display="block";if(this.isMultiSelectKeyPressed(event)){this._prevSelected=this.selected.slice()}else{this._prevSelected=[]}this._getStartingPositions(event);this.checkIfInsideSelection(true);this.selector.style.display="none";this.onDragStart(event);if(this._breaked){return false}this.area.removeEventListener("mousedown",this._startUp);this.area.removeEventListener("touchstart",this._startUp,{passive:false});this.area.addEventListener("mousemove",this._handleMove);this.area.addEventListener("touchmove",this._handleMove);document.addEventListener("mouseup",this.reset);document.addEventListener("touchend",this.reset)};DragSelect.prototype._getStartingPositions=function(event){this.initialCursorPos=this.newCursorPos=this._getCursorPos(event,this.area);this.initialScroll=this.getScroll(this.area);var selectorPos={x:this.initialCursorPos.x+this.initialScroll.x,y:this.initialCursorPos.y+this.initialScroll.y,w:0,h:0};this.updatePos(this.selector,selectorPos)};DragSelect.prototype._handleMove=function(event){var selectorPos=this.getPosition(event);this.onDragMove(event);if(this._breaked)return false;this.selector.style.display="block";this.updatePos(this.selector,selectorPos);this.checkIfInsideSelection();this._autoScroll(event)};DragSelect.prototype.getPosition=function(event){var cursorPosNew=this._getCursorPos(event,this.area);var scrollNew=this.getScroll(this.area);this.newCursorPos=cursorPosNew;var scrollAmount={x:scrollNew.x-this.initialScroll.x,y:scrollNew.y-this.initialScroll.y};var selectorPos={x:0,w:0,y:0,h:0};if(cursorPosNew.x>this.initialCursorPos.x-scrollAmount.x){selectorPos.x=this.initialCursorPos.x+this.initialScroll.x;selectorPos.w=cursorPosNew.x-this.initialCursorPos.x+scrollAmount.x}else{selectorPos.x=cursorPosNew.x+scrollNew.x;selectorPos.w=this.initialCursorPos.x-cursorPosNew.x-scrollAmount.x}if(cursorPosNew.y>this.initialCursorPos.y-scrollAmount.y){selectorPos.y=this.initialCursorPos.y+this.initialScroll.y;selectorPos.h=cursorPosNew.y-this.initialCursorPos.y+scrollAmount.y}else{selectorPos.y=cursorPosNew.y+scrollNew.y;selectorPos.h=this.initialCursorPos.y-cursorPosNew.y-scrollAmount.y}return selectorPos};DragSelect.prototype.checkIfInsideSelection=function(force){var anyInside=false;for(var i=0,il=this.selectables.length;i<il;i++){var selectable=this.selectables[i];var scroll=this.getScroll(this.area);var selectionRect={y:this.selector.getBoundingClientRect().top+scroll.y,x:this.selector.getBoundingClientRect().left+scroll.x,h:this.selector.offsetHeight,w:this.selector.offsetWidth};if(this.isElementTouching(selectable,selectionRect,scroll)){this._handleSelection(selectable,force);anyInside=true}else{this._handleUnselection(selectable,force)}}return anyInside};DragSelect.prototype._handleSelection=function(item,force){if(item.classList.contains(this.hoverClass)&&!force)return false;var posInSelectedArray=this.selected.indexOf(item);if(posInSelectedArray<0)this.select(item);else if(posInSelectedArray>-1&&this.multiSelectKeyPressed)this.unselect(item);item.classList.add(this.hoverClass)};DragSelect.prototype._handleUnselection=function(item,force){if(!item.classList.contains(this.hoverClass)&&!force)return false;var posInSelectedArray=this.selected.indexOf(item);var isInPrevSelection=this._prevSelected.indexOf(item);if(posInSelectedArray>-1&&isInPrevSelection<0)this.unselect(item);else if(posInSelectedArray<0&&isInPrevSelection>-1)this.select(item);item.classList.remove(this.hoverClass)};DragSelect.prototype.select=function(item){if(this.selected.indexOf(item)>-1)return item;this.selected.push(item);item.classList.add(this.selectedClass);this.onElementSelect(item);return item};DragSelect.prototype.unselect=function(item){if(this.selected.indexOf(item)<0)return item;this.selected.splice(this.selected.indexOf(item),1);item.classList.remove(this.selectedClass);this.onElementUnselect(item);return item};DragSelect.prototype.toggle=function(item){if(this.selected.indexOf(item)>-1)return this.unselect(item);return this.select(item)};DragSelect.prototype._autoScroll=function(event){var edge=this.isCursorNearEdge(event,this.area);var docEl=document&&document.documentElement&&document.documentElement.scrollTop&&document.documentElement;var _area=this.area===document?docEl||document.body:this.area;if(edge==="top"&&_area.scrollTop>0)return _area.scrollTop-=1*this.autoScrollSpeed;if(edge==="bottom")return _area.scrollTop+=1*this.autoScrollSpeed;if(edge==="left"&&_area.scrollLeft>0)return _area.scrollLeft-=1*this.autoScrollSpeed;if(edge==="right")return _area.scrollLeft+=1*this.autoScrollSpeed};DragSelect.prototype.isCursorNearEdge=function(event,area){var cursorPosition=this._getCursorPos(event,area);var areaRect=this.getAreaRect(area);var tolerance={x:Math.max(areaRect.width/10,30),y:Math.max(areaRect.height/10,30)};if(cursorPosition.y<tolerance.y)return"top";if(areaRect.height-cursorPosition.y<tolerance.y)return"bottom";if(areaRect.width-cursorPosition.x<tolerance.x)return"right";if(cursorPosition.x<tolerance.x)return"left";return false};DragSelect.prototype.reset=function(event){var _this=this;this.previousCursorPos=this._getCursorPos(event,this.area);document.removeEventListener("mouseup",this.reset);document.removeEventListener("touchend",this.reset);this.area.removeEventListener("mousemove",this._handleMove);this.area.removeEventListener("touchmove",this._handleMove);this.area.addEventListener("mousedown",this._startUp);this.area.addEventListener("touchstart",this._startUp,{passive:false});this.callback(this.selected,event);if(this._breaked)return false;this.selector.style.width="0";this.selector.style.height="0";this.selector.style.display="none";setTimeout(function(){return _this.mouseInteraction=false},100)};DragSelect.prototype.break=function(){var _this=this;this._breaked=true;setTimeout(function(){return _this._breaked=false},100)};DragSelect.prototype.stop=function(){this.reset();this.area.removeEventListener("mousedown",this._startUp);this.area.removeEventListener("touchstart",this._startUp,{passive:false});document.removeEventListener("mouseup",this.reset);document.removeEventListener("touchend",this.reset)};DragSelect.prototype.getSelection=function(){return this.selected};DragSelect.prototype.getCursorPos=function(event,_area,ignoreScroll){var area=_area||_area!==false&&this.area;var pos=this._getCursorPos(event,area);var scroll=ignoreScroll?{x:0,y:0}:this.getScroll(area);return{x:pos.x+scroll.x,y:pos.y+scroll.y}};DragSelect.prototype.addSelection=function(_nodes,triggerCallback,dontAddToSelectables){var _this=this;var nodes=this.toArray(_nodes);nodes.forEach(function(node){return _this.select(node)});if(!dontAddToSelectables)this.addSelectables(nodes);if(triggerCallback)this.callback(this.selected,false);return this.selected};DragSelect.prototype.removeSelection=function(_nodes,triggerCallback,removeFromSelectables){var _this=this;var nodes=this.toArray(_nodes);nodes.forEach(function(node){return _this.unselect(node)});if(removeFromSelectables)this.removeSelectables(nodes);if(triggerCallback)this.callback(this.selected,false);return this.selected};DragSelect.prototype.toggleSelection=function(_nodes,triggerCallback,_special){var _this=this;var nodes=this.toArray(_nodes);nodes.forEach(function(node){if(_this.selected.indexOf(node)<0)_this.addSelection(node,triggerCallback,_special);else _this.removeSelection(node,triggerCallback,_special)});return this.selected};DragSelect.prototype.setSelection=function(nodes,triggerCallback,dontAddToSelectables){this.clearSelection();this.addSelection(nodes,triggerCallback,dontAddToSelectables);return this.selected};DragSelect.prototype.clearSelection=function(triggerCallback){var _this=this;var selection=this.selected.slice();selection.forEach(function(node){return _this.unselect(node)});if(triggerCallback)this.callback(this.selected,false);return this.selected};DragSelect.prototype.addSelectables=function(_nodes,addToSelection){var nodes=this.toArray(_nodes);this._handleSelectables(nodes,false,addToSelection);return this.selectables};DragSelect.prototype.getSelectables=function(){return this.selectables};DragSelect.prototype.setSelectables=function(nodes,removeFromSelection,addToSelection){this.removeSelectables(this.getSelectables(),removeFromSelection);return this.addSelectables(nodes,addToSelection)};DragSelect.prototype.removeSelectables=function(_nodes,removeFromSelection){var nodes=this.toArray(_nodes);this._handleSelectables(nodes,true,removeFromSelection);return this.selectables};DragSelect.prototype.isRightClick=function(event){if(!event)return false;var isRightMB=false;if("which"in event){isRightMB=event.which===3}else if("button"in event){isRightMB=event.button===2}return isRightMB};DragSelect.prototype._getCursorPos=function(event,area){if(!event)return{x:0,y:0};if("touches"in event&&event.type!=="touchend")this._lastTouch=event;event=event.touches?this._lastTouch.touches[0]:event;var cPos={x:event.pageX,y:event.pageY};var areaRect=this.getAreaRect(area||document);var docScroll=this.getScroll();return{x:cPos.x-areaRect.left-docScroll.x,y:cPos.y-areaRect.top-docScroll.y}};DragSelect.prototype.getInitialCursorPosition=function(){return this.initialCursorPos};DragSelect.prototype.getCurrentCursorPosition=function(){return this.newCursorPos};DragSelect.prototype.getPreviousCursorPosition=function(){return this.previousCursorPos};DragSelect.prototype.getCursorPositionDifference=function(usePreviousCursorDifference){var posA=this.getCurrentCursorPosition();var posB=usePreviousCursorDifference?this.getPreviousCursorPosition():this.getInitialCursorPosition();return{x:posA.x-posB.x,y:posA.y-posB.y}};DragSelect.prototype.getScroll=function(area){var body={top:document.body.scrollTop>0?document.body.scrollTop:document.documentElement.scrollTop,left:document.body.scrollLeft>0?document.body.scrollLeft:document.documentElement.scrollLeft};var scroll={y:area&&area.scrollTop>=0?area.scrollTop:body.top,x:area&&area.scrollLeft>=0?area.scrollLeft:body.left};return scroll};DragSelect.prototype.getAreaRect=function(area){if(area===document){var size={y:area.documentElement.clientHeight>0?area.documentElement.clientHeight:window.innerHeight,x:area.documentElement.clientWidth>0?area.documentElement.clientWidth:window.innerWidth};return{top:0,left:0,bottom:0,right:0,width:size.x,height:size.y}}var rect=area.getBoundingClientRect();return{top:rect.top,left:rect.left,bottom:rect.bottom,right:rect.right,width:rect.width,height:rect.height}};DragSelect.prototype.updatePos=function(node,pos){node.style.left=pos.x+"px";node.style.top=pos.y+"px";node.style.width=pos.w+"px";node.style.height=pos.h+"px";return node};DragSelect.prototype.toArray=function(nodes){if(!nodes.length&&this.isElement(nodes))return[nodes];var array=[];for(var i=nodes.length-1;i>=0;i--){array[i]=nodes[i]}return array};DragSelect.prototype.isElement=function(node){try{return node instanceof HTMLElement||node instanceof SVGElement}catch(e){return typeof node==="object"&&node.nodeType===1&&typeof node.style==="object"&&typeof node.ownerDocument==="object"}};return DragSelect}();
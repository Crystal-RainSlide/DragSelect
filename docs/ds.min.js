"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function DragSelect(options){this.multiSelectKeyPressed;this.initialCursorPos={x:0,y:0};this.newCursorPos={x:0,y:0};this.previousCursorPos={x:0,y:0};this.initialScroll;this.selected=[];this._prevSelected=[];this._createBindings();this._setupOptions(options);this.start()}DragSelect.prototype._createBindings=function(){this._startUp=this._startUp.bind(this);this._handleMove=this._handleMove.bind(this);this.reset=this.reset.bind(this);this._onClick=this._onClick.bind(this)};DragSelect.prototype._setupOptions=function(options){this.selectedClass=options.selectedClass||"ds-selected";this.hoverClass=options.hoverClass||"ds-hover";this.selectorClass=options.selectorClass||"ds-selector";this.selectableClass=options.selectableClass||"ds-selectable";this.selectables=[];this._handleSelectables(this.toArray(options.selectables));this.multiSelectKeys=options.multiSelectKeys||["ctrlKey","shiftKey","metaKey"];this.multiSelectMode=options.multiSelectMode||false;this.autoScrollSpeed=options.autoScrollSpeed===0?0:options.autoScrollSpeed||1;this.selectCallback=options.onElementSelect||function(){};this.unselectCallback=options.onElementUnselect||function(){};this.onDragStartBegin=options.onDragStartBegin||function(){};this.moveStartCallback=options.onDragStart||function(){};this.moveCallback=options.onDragMove||function(){};this.callback=options.callback||function(){};this.area=options.area||document;this.customStyles=options.customStyles;if(this.area!==document){var computedArea=getComputedStyle(this.area);var isPositioned=computedArea.position==="absolute"||computedArea.position==="relative"||computedArea.position==="fixed";if(!isPositioned){this.area.style.position="relative"}}this.selector=options.selector||this._createSelector();this.addClass(this.selector,this.selectorClass)};DragSelect.prototype._handleSelectables=function(selectables,remove,fromSelection){for(var index=0;index<selectables.length;index++){var selectable=selectables[index];var indexOf=this.selectables.indexOf(selectable);if(indexOf<0&&!remove){this.addClass(selectable,this.selectableClass);selectable.addEventListener("click",this._onClick);this.selectables.push(selectable);if(fromSelection&&this.selected.indexOf(selectable)<0){this.addClass(selectable,this.selectedClass);this.selected.push(selectable)}}else if(indexOf>-1&&remove){this.removeClass(selectable,this.hoverClass);this.removeClass(selectable,this.selectableClass);selectable.removeEventListener("click",this._onClick);this.selectables.splice(indexOf,1);if(fromSelection&&this.selected.indexOf(selectable)>-1){this.removeClass(selectable,this.selectedClass);this.selected.splice(this.selected.indexOf(selectable),1)}}}};DragSelect.prototype._onClick=function(event){if(this.mouseInteraction){return}if(this.isRightClick(event)){return}var node=event.target;if(this.isMultiSelectKeyPressed(event)){this._prevSelected=this.selected.slice()}else{this._prevSelected=[]}this.checkIfInsideSelection(true);if(this.selectables.indexOf(node)>-1){this.toggle(node)}this.reset()};DragSelect.prototype._createSelector=function(){var selector=document.createElement("div");selector.style.position="absolute";if(!this.customStyles){selector.style.background="rgba(0, 0, 255, 0.1)";selector.style.border="1px solid rgba(0, 0, 255, 0.45)";selector.style.display="none";selector.style.pointerEvents="none"}var _area=this.area===document?document.body:this.area;_area.appendChild(selector);return selector};DragSelect.prototype.start=function(){this.area.addEventListener("mousedown",this._startUp);this.area.addEventListener("touchstart",this._startUp,{passive:false})};DragSelect.prototype._startUp=function(event){if(event.type==="touchstart")event.preventDefault();this.onDragStartBegin(event);if(this._breaked){return false}if(this.isRightClick(event)){return}this.mouseInteraction=true;this.selector.style.display="block";if(this.isMultiSelectKeyPressed(event)){this._prevSelected=this.selected.slice()}else{this._prevSelected=[]}this._getStartingPositions(event);this.checkIfInsideSelection(true);this.selector.style.display="none";this.moveStartCallback(event);if(this._breaked){return false}this.area.removeEventListener("mousedown",this._startUp);this.area.removeEventListener("touchstart",this._startUp,{passive:false});this.area.addEventListener("mousemove",this._handleMove);this.area.addEventListener("touchmove",this._handleMove);document.addEventListener("mouseup",this.reset);document.addEventListener("touchend",this.reset)};DragSelect.prototype.isMultiSelectKeyPressed=function(event){this.multiSelectKeyPressed=false;if(this.multiSelectMode){this.multiSelectKeyPressed=true}else{for(var index=0;index<this.multiSelectKeys.length;index++){var mKey=this.multiSelectKeys[index];if(event[mKey]){this.multiSelectKeyPressed=true}}}return this.multiSelectKeyPressed};DragSelect.prototype._getStartingPositions=function(event){this.initialCursorPos=this.newCursorPos=this._getCursorPos(event,this.area);this.initialScroll=this.getScroll(this.area);var selectorPos={};selectorPos.x=this.initialCursorPos.x+this.initialScroll.x;selectorPos.y=this.initialCursorPos.y+this.initialScroll.y;selectorPos.w=0;selectorPos.h=0;this.updatePos(this.selector,selectorPos)};DragSelect.prototype._handleMove=function(event){var selectorPos=this.getPosition(event);this.moveCallback(event);if(this._breaked){return false}this.selector.style.display="block";this.updatePos(this.selector,selectorPos);this.checkIfInsideSelection();this._autoScroll(event)};DragSelect.prototype.getPosition=function(event){var cursorPosNew=this._getCursorPos(event,this.area);var scrollNew=this.getScroll(this.area);this.newCursorPos=cursorPosNew;var scrollAmount={x:scrollNew.x-this.initialScroll.x,y:scrollNew.y-this.initialScroll.y};var selectorPos={};if(cursorPosNew.x>this.initialCursorPos.x-scrollAmount.x){selectorPos.x=this.initialCursorPos.x+this.initialScroll.x;selectorPos.w=cursorPosNew.x-this.initialCursorPos.x+scrollAmount.x}else{selectorPos.x=cursorPosNew.x+scrollNew.x;selectorPos.w=this.initialCursorPos.x-cursorPosNew.x-scrollAmount.x}if(cursorPosNew.y>this.initialCursorPos.y-scrollAmount.y){selectorPos.y=this.initialCursorPos.y+this.initialScroll.y;selectorPos.h=cursorPosNew.y-this.initialCursorPos.y+scrollAmount.y}else{selectorPos.y=cursorPosNew.y+scrollNew.y;selectorPos.h=this.initialCursorPos.y-cursorPosNew.y-scrollAmount.y}return selectorPos};DragSelect.prototype.checkIfInsideSelection=function(force){var anyInside=false;for(var i=0,il=this.selectables.length;i<il;i++){var selectable=this.selectables[i];var scroll=this.getScroll(this.area);var selectionRect={y:this.selector.getBoundingClientRect().top+scroll.y,x:this.selector.getBoundingClientRect().left+scroll.x,h:this.selector.offsetHeight,w:this.selector.offsetWidth};if(this._isElementTouching(selectable,selectionRect,scroll)){this._handleSelection(selectable,force);anyInside=true}else{this._handleUnselection(selectable,force)}}return anyInside};DragSelect.prototype._handleSelection=function(item,force){if(this.hasClass(item,this.hoverClass)&&!force){return false}var posInSelectedArray=this.selected.indexOf(item);if(posInSelectedArray<0){this.select(item)}else if(posInSelectedArray>-1&&this.multiSelectKeyPressed){this.unselect(item)}this.addClass(item,this.hoverClass)};DragSelect.prototype._handleUnselection=function(item,force){if(!this.hasClass(item,this.hoverClass)&&!force){return false}var posInSelectedArray=this.selected.indexOf(item);var isInPrevSelection=this._prevSelected.indexOf(item);if(posInSelectedArray>-1&&isInPrevSelection<0){this.unselect(item)}else if(posInSelectedArray<0&&isInPrevSelection>-1){this.select(item)}this.removeClass(item,this.hoverClass)};DragSelect.prototype.select=function(item){if(this.selected.indexOf(item)>-1){return false}this.selected.push(item);this.addClass(item,this.selectedClass);this.selectCallback(item);if(this._breaked){return false}return item};DragSelect.prototype.unselect=function(item){if(this.selected.indexOf(item)<0){return false}this.selected.splice(this.selected.indexOf(item),1);this.removeClass(item,this.selectedClass);this.unselectCallback(item);if(this._breaked){return false}return item};DragSelect.prototype.toggle=function(item){if(this.selected.indexOf(item)>-1){this.unselect(item)}else{this.select(item)}return item};DragSelect.prototype._isElementTouching=function(element,selectionRect,scroll){var elementRect={y:element.getBoundingClientRect().top+scroll.y,x:element.getBoundingClientRect().left+scroll.x,h:element.offsetHeight||element.getBoundingClientRect().height,w:element.offsetWidth||element.getBoundingClientRect().width};if(selectionRect.x<elementRect.x+elementRect.w&&selectionRect.x+selectionRect.w>elementRect.x&&selectionRect.y<elementRect.y+elementRect.h&&selectionRect.h+selectionRect.y>elementRect.y){return true}else{return false}};DragSelect.prototype._autoScroll=function(event){var edge=this.isCursorNearEdge(event,this.area);var docEl=document&&document.documentElement&&document.documentElement.scrollTop&&document.documentElement;var _area=this.area===document?docEl||document.body:this.area;if(edge==="top"&&_area.scrollTop>0){_area.scrollTop-=1*this.autoScrollSpeed}else if(edge==="bottom"){_area.scrollTop+=1*this.autoScrollSpeed}else if(edge==="left"&&_area.scrollLeft>0){_area.scrollLeft-=1*this.autoScrollSpeed}else if(edge==="right"){_area.scrollLeft+=1*this.autoScrollSpeed}};DragSelect.prototype.isCursorNearEdge=function(event,area){var cursorPosition=this._getCursorPos(event,area);var areaRect=this.getAreaRect(area);var tolerance={x:Math.max(areaRect.width/10,30),y:Math.max(areaRect.height/10,30)};if(cursorPosition.y<tolerance.y){return"top"}else if(areaRect.height-cursorPosition.y<tolerance.y){return"bottom"}else if(areaRect.width-cursorPosition.x<tolerance.x){return"right"}else if(cursorPosition.x<tolerance.x){return"left"}return false};DragSelect.prototype.reset=function(event){this.previousCursorPos=this._getCursorPos(event,this.area);document.removeEventListener("mouseup",this.reset);document.removeEventListener("touchend",this.reset);this.area.removeEventListener("mousemove",this._handleMove);this.area.removeEventListener("touchmove",this._handleMove);this.area.addEventListener("mousedown",this._startUp);this.area.addEventListener("touchstart",this._startUp,{passive:false});this.callback(this.selected,event);if(this._breaked){return false}this.selector.style.width="0";this.selector.style.height="0";this.selector.style.display="none";setTimeout(function(){this.mouseInteraction=false}.bind(this),100)};DragSelect.prototype.break=function(){this._breaked=true;setTimeout(function(){this._breaked=false}.bind(this),100)};DragSelect.prototype.stop=function(){this.reset();this.area.removeEventListener("mousedown",this._startUp);this.area.removeEventListener("touchstart",this._startUp,{passive:false});document.removeEventListener("mouseup",this.reset);document.removeEventListener("touchend",this.reset)};DragSelect.prototype.getSelection=function(){return this.selected};DragSelect.prototype.getCursorPos=function(event,_area,ignoreScroll){if(!event){return false}var area=_area||_area!==false&&this.area;var pos=this._getCursorPos(event,area);var scroll=ignoreScroll?{x:0,y:0}:this.getScroll(area);return{x:pos.x+scroll.x,y:pos.y+scroll.y}};DragSelect.prototype.addSelection=function(_nodes,_callback,dontAddToSelectables){var nodes=this.toArray(_nodes);for(var index=0,il=nodes.length;index<il;index++){var node=nodes[index];this.select(node)}if(!dontAddToSelectables){this.addSelectables(nodes)}if(_callback){this.callback(this.selected,false)}return this.selected};DragSelect.prototype.removeSelection=function(_nodes,_callback,removeFromSelectables){var nodes=this.toArray(_nodes);for(var index=0,il=nodes.length;index<il;index++){var node=nodes[index];this.unselect(node)}if(removeFromSelectables){this.removeSelectables(nodes)}if(_callback){this.callback(this.selected,false)}return this.selected};DragSelect.prototype.toggleSelection=function(_nodes,_callback,_special){var nodes=this.toArray(_nodes);for(var index=0,il=nodes.length;index<il;index++){var node=nodes[index];if(this.selected.indexOf(node)<0){this.addSelection(node,_callback,_special)}else{this.removeSelection(node,_callback,_special)}}return this.selected};DragSelect.prototype.setSelection=function(_nodes,runCallback,dontAddToSelectables){this.clearSelection();this.addSelection(_nodes,runCallback,dontAddToSelectables);return this.selected};DragSelect.prototype.clearSelection=function(runCallback){var selection=this.selected.slice();for(var index=0,il=selection.length;index<il;index++){var node=selection[index];this.unselect(node)}if(runCallback){this.callback(this.selected,false)}return this.selected};DragSelect.prototype.addSelectables=function(_nodes,addToSelection){var nodes=this.toArray(_nodes);this._handleSelectables(nodes,false,addToSelection);return _nodes};DragSelect.prototype.getSelectables=function(){return this.selectables};DragSelect.prototype.setSelectables=function(_nodes,removeFromSelection,addToSelection){this.removeSelectables(this.getSelectables(),removeFromSelection);return this.addSelectables(_nodes,addToSelection)};DragSelect.prototype.removeSelectables=function(_nodes,removeFromSelection){var nodes=this.toArray(_nodes);this._handleSelectables(nodes,true,removeFromSelection);return _nodes};DragSelect.prototype.isRightClick=function(event){if(!event){return false}var isRightMB=false;if("which"in event){isRightMB=event.which===3}else if("button"in event){isRightMB=event.button===2}return isRightMB};DragSelect.prototype.addClass=function(element,classname){if(element.classList){return element.classList.add(classname)}var cn=element.getAttribute("class")||"";if(cn.indexOf(classname)!==-1){return element}if(cn!==""){classname=" "+classname}element.setAttribute("class",cn+classname);return element};DragSelect.prototype.removeClass=function(element,classname){if(element.classList){return element.classList.remove(classname)}var cn=element.getAttribute("class")||"";var rxp=new RegExp(classname+"\\b","g");cn=cn.replace(rxp,"");element.setAttribute("class",cn);return element};DragSelect.prototype.hasClass=function(element,classname){if(element.classList){return element.classList.contains(classname)}var cn=element.getAttribute("class")||"";if(cn.indexOf(classname)>-1){return true}else{return false}};DragSelect.prototype.toArray=function(nodes){if(!nodes){return false}if(!nodes.length&&this.isElement(nodes)){return[nodes]}var array=[];for(var i=nodes.length-1;i>=0;i--){array[i]=nodes[i]}return array};DragSelect.prototype.isElement=function(node){try{return node instanceof HTMLElement||node instanceof SVGElement}catch(e){return _typeof(node)==="object"&&node.nodeType===1&&_typeof(node.style)==="object"&&_typeof(node.ownerDocument)==="object"}};DragSelect.prototype._getCursorPos=function(event,area){if(!event){return{x:0,y:0}}if(event.touches&&event.type!=="touchend"){DragSelect.prototype.lastTouch=event}event=event.touches?DragSelect.prototype.lastTouch.touches[0]:event;var cPos={x:event.pageX||event.clientX,y:event.pageY||event.clientY};var areaRect=this.getAreaRect(area||document);var docScroll=this.getScroll();return{x:cPos.x-areaRect.left-docScroll.x,y:cPos.y-areaRect.top-docScroll.y}};DragSelect.prototype.getInitialCursorPosition=function(){return this.initialCursorPos};DragSelect.prototype.getCurrentCursorPosition=function(){return this.newCursorPos};DragSelect.prototype.getPreviousCursorPosition=function(){return this.previousCursorPos};DragSelect.prototype.getCursorPositionDifference=function(usePreviousCursorDifference){var posA=this.getCurrentCursorPosition();var posB=usePreviousCursorDifference?this.getPreviousCursorPosition():this.getInitialCursorPosition();return{x:posA.x-posB.x,y:posA.y-posB.y}};DragSelect.prototype.getScroll=function(area){var body={top:document.body.scrollTop>0?document.body.scrollTop:document.documentElement.scrollTop,left:document.body.scrollLeft>0?document.body.scrollLeft:document.documentElement.scrollLeft};var scroll={y:area&&area.scrollTop>=0?area.scrollTop:body.top,x:area&&area.scrollLeft>=0?area.scrollLeft:body.left};return scroll};DragSelect.prototype.getAreaRect=function(area){if(area===document){var size={y:area.documentElement.clientHeight>0?area.documentElement.clientHeight:window.innerHeight,x:area.documentElement.clientWidth>0?area.documentElement.clientWidth:window.innerWidth};return{top:0,left:0,bottom:0,right:0,width:size.x,height:size.y}}return{top:area.getBoundingClientRect().top,left:area.getBoundingClientRect().left,bottom:area.getBoundingClientRect().bottom,right:area.getBoundingClientRect().right,width:area.offsetWidth,height:area.offsetHeight}};DragSelect.prototype.updatePos=function(node,pos){node.style.left=pos.x+"px";node.style.top=pos.y+"px";node.style.width=pos.w+"px";node.style.height=pos.h+"px";return node};if(typeof module!=="undefined"&&module!==null){module.exports=DragSelect}else if(typeof define!=="undefined"&&typeof define==="function"&&define){define(function(){return DragSelect})}else{window.DragSelect=DragSelect}